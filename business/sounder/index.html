<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sounder — Unified Swine Genetics Infrastructure</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Oswald:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --purple-500:#7200CB;--purple-600:#5B00A2;--purple-700:#44007A;--purple-800:#2E0051;
  --magenta-500:#F000D2;--magenta-400:#F333DB;
  --cyan-500:#21D6C6;--cyan-400:#4DDED1;
  --dark:#232324;--surface:#2D2B2E;--surface-v:#3D3B3E;--border:#4A474B;
  --text:#F2F2F3;--text-dim:#8a8590;
  --glass-bg:rgba(10,10,15,0.88);--glass-border:rgba(114,0,203,0.15);
}
html{scroll-behavior:smooth}
body{background:var(--dark);color:var(--text);font-family:'Inter',system-ui,sans-serif;overflow-x:hidden;line-height:1.6}


/* === 3D GRAPH BACKGROUND === */
#canvas-container{position:fixed;top:0;left:0;width:100%;height:100%;z-index:0;opacity:0.55}
#labels-container{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:1;opacity:0.4}
.node-label{position:absolute;font-size:8px;white-space:nowrap;text-shadow:0 0 4px rgba(0,0,0,0.9);transform:translate(-50%,-100%);transition:opacity 0.3s;letter-spacing:0.5px;font-family:'Courier New',monospace}

/* === SCROLL CONTENT === */
#scroll-content{position:relative;z-index:10;pointer-events:none}
.section{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:80px 24px;pointer-events:none}
.section-inner{max-width:900px;width:100%;pointer-events:auto}

/* Glass panel */
.glass{
  background:var(--glass-bg);
  backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);
  border:1px solid var(--glass-border);
  border-radius:16px;
  padding:48px;
  opacity:0;transform:translateY(40px);
  transition:opacity 0.8s ease,transform 0.8s ease;
}
.glass.visible{opacity:1;transform:translateY(0)}

/* === TYPOGRAPHY === */
h1.hero-title{
  font-family:'Oswald',sans-serif;font-size:clamp(48px,10vw,96px);font-weight:700;letter-spacing:6px;
  background:linear-gradient(135deg,var(--purple-500),var(--magenta-500));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  background-clip:text;line-height:1.05;margin-bottom:8px;
}
.hero-sub{font-family:'Oswald',sans-serif;font-size:clamp(16px,3vw,22px);font-weight:400;letter-spacing:3px;text-transform:uppercase;color:var(--cyan-500);margin-bottom:24px}
.hero-desc{font-size:15px;color:var(--text-dim);max-width:600px;margin-bottom:32px}

h2.section-title{
  font-family:'Oswald',sans-serif;font-size:clamp(28px,5vw,42px);font-weight:600;letter-spacing:2px;
  color:var(--text);margin-bottom:8px;line-height:1.2;
}
h2.section-title span.accent{color:var(--cyan-500)}
.section-subtitle{font-size:14px;color:var(--magenta-500);letter-spacing:2px;text-transform:uppercase;margin-bottom:20px;font-weight:500}
.section-body{font-size:15px;color:var(--text-dim);line-height:1.8;margin-bottom:24px}
.section-body strong{color:var(--text)}

/* === STAT BAR === */
.stat-bar{display:flex;flex-wrap:wrap;gap:0;border:1px solid var(--glass-border);border-radius:10px;overflow:hidden;margin-top:8px}
.stat-item{flex:1;min-width:120px;padding:16px 12px;text-align:center;border-right:1px solid var(--glass-border);background:rgba(114,0,203,0.04)}
.stat-item:last-child{border-right:none}
.stat-val{display:block;font-family:'Oswald',sans-serif;font-size:24px;font-weight:600;color:var(--text)}
.stat-lbl{display:block;font-size:10px;letter-spacing:2px;color:var(--text-dim);margin-top:4px;text-transform:uppercase}

/* === PROBLEM LIST === */
.problem-list{list-style:none;padding:0}
.problem-list li{position:relative;padding:12px 0 12px 28px;border-bottom:1px solid rgba(255,255,255,0.04);font-size:15px;color:var(--text-dim);line-height:1.7}
.problem-list li::before{content:'';position:absolute;left:0;top:20px;width:12px;height:12px;border-radius:50%;background:var(--magenta-500);opacity:0.5}
.problem-list li strong{color:var(--text)}

/* === PRIMITIVE CARDS === */
.prim-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:12px;margin-top:24px}
.prim-card{background:rgba(114,0,203,0.06);border:1px solid var(--glass-border);border-radius:12px;padding:20px 16px;text-align:center;transition:border-color 0.3s,transform 0.3s}
.prim-card:hover{border-color:var(--purple-500);transform:translateY(-2px)}
.prim-icon{font-size:28px;margin-bottom:8px;display:block}
.prim-name{font-family:'Oswald',sans-serif;font-size:16px;font-weight:600;letter-spacing:2px;margin-bottom:8px}
.prim-name.c-purple{color:var(--purple-500)}.prim-name.c-magenta{color:var(--magenta-500)}.prim-name.c-cyan{color:var(--cyan-500)}.prim-name.c-red{color:#CE4F51}.prim-name.c-gold{color:#E9C46A}
.prim-examples{font-size:12px;color:var(--text-dim);line-height:1.6}
.prim-examples strong{color:var(--text);font-weight:500}

/* === FARM MAP === */
.farm-map-container{position:relative;width:100%;max-width:700px;margin:24px auto}
.farm-map-container svg{width:100%;height:auto}
.farm-node{cursor:default}
.farm-label{font-family:'Inter',sans-serif;fill:var(--text);font-size:11px;font-weight:500}
.farm-sublabel{font-family:'Inter',sans-serif;fill:var(--text-dim);font-size:9px}
.farm-center-label{font-family:'Oswald',sans-serif;fill:var(--cyan-500);font-size:14px;font-weight:600;letter-spacing:1px}
@keyframes pulse-ring{0%{r:8;opacity:0.6}100%{r:20;opacity:0}}

/* === CONTRACT CARDS === */
.contract-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin-top:24px}
.contract-card{background:rgba(33,214,198,0.04);border:1px solid rgba(33,214,198,0.15);border-radius:10px;padding:16px}
.contract-card h4{font-family:'Oswald',sans-serif;font-size:14px;font-weight:600;color:var(--cyan-500);letter-spacing:1px;margin-bottom:6px}
.contract-card p{font-size:12px;color:var(--text-dim);line-height:1.6}

/* === PRIORITY CARDS === */
.priority-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px;margin-top:24px}
.priority-card{background:rgba(114,0,203,0.06);border:1px solid var(--glass-border);border-radius:10px;padding:20px;display:flex;gap:14px;align-items:flex-start}
.priority-num{font-family:'Oswald',sans-serif;font-size:28px;font-weight:700;color:var(--purple-500);line-height:1;flex-shrink:0;width:32px;text-align:center}
.priority-card h4{font-size:14px;font-weight:600;color:var(--text);margin-bottom:4px}
.priority-card p{font-size:12px;color:var(--text-dim);line-height:1.5}

/* === DATA STAT CARDS === */
.data-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin-top:24px}
.data-card{background:rgba(240,0,210,0.04);border:1px solid rgba(240,0,210,0.12);border-radius:10px;padding:20px;text-align:center}
.data-card .d-val{font-family:'Oswald',sans-serif;font-size:32px;font-weight:600;color:var(--text);display:block}
.data-card .d-lbl{font-size:11px;color:var(--text-dim);letter-spacing:1px;margin-top:4px;text-transform:uppercase}

/* === CLOSING === */
.closing-line{font-family:'Oswald',sans-serif;font-size:clamp(18px,3vw,24px);color:var(--text-dim);letter-spacing:1px;line-height:1.6;margin-top:24px}
.closing-line strong{color:var(--text)}

/* === SPACER === */
.spacer{height:50vh;pointer-events:none}

/* === MOBILE === */
@media(max-width:640px){
  .glass{padding:28px 20px}
  .prim-grid{grid-template-columns:repeat(2,1fr)}
  .contract-grid,.priority-grid{grid-template-columns:1fr}
  .data-grid{grid-template-columns:repeat(2,1fr)}
  .stat-item{min-width:80px;padding:12px 6px}
  .stat-val{font-size:18px}
  .farm-map-container svg{min-height:300px}
}

/* === SCROLLBAR === */
::-webkit-scrollbar{width:6px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--purple-800);border-radius:3px}
::-webkit-scrollbar-thumb:hover{background:var(--purple-700)}
</style>
</head>
<body>


<!-- ═══ 3D GRAPH BACKGROUND ═══ -->
<div id="canvas-container"></div>
<div id="labels-container"></div>

<!-- ═══ SCROLL CONTENT ═══ -->
<div id="scroll-content">

  <!-- SPACER so graph is visible on load -->
  <div class="spacer"></div>

  <!-- SECTION 1: HERO -->
  <div class="section">
    <div class="section-inner">
      <div class="glass">
        <h1 class="hero-title">SOUNDER</h1>
        <div class="hero-sub">Unified Swine Genetics Infrastructure</div>
        <p class="hero-desc">Charlotte substrate for the swine industry. One graph connecting every breeder, every animal, every sale, every show &mdash; across all registries.</p>
        <div class="stat-bar">
          <div class="stat-item"><span class="stat-val">3</span><span class="stat-lbl">Registries</span></div>
          <div class="stat-item"><span class="stat-val">77K</span><span class="stat-lbl">Breeders</span></div>
          <div class="stat-item"><span class="stat-val">401K</span><span class="stat-lbl">Facts</span></div>
          <div class="stat-item"><span class="stat-val">20K</span><span class="stat-lbl">Breeding Cycles</span></div>
        </div>
      </div>
    </div>
  </div>

  <!-- SECTION 2: THE PROBLEM -->
  <div class="section">
    <div class="section-inner">
      <div class="glass">
        <div class="section-subtitle">The Problem</div>
        <h2 class="section-title">The swine industry is <span class="accent">fragmented</span>.</h2>
        <ul class="problem-list">
          <li><strong>3 separate registries</strong> (CPS, NSR, ABA) with no shared database</li>
          <li><strong>No system for crossbred ancestry</strong> &mdash; 60%+ of show pigs have no pedigree trail</li>
          <li>Breeders use <strong>4&ndash;5 different fringe software tools</strong> that don't talk to each other</li>
          <li>Sale records live in <strong>Facebook Messenger threads</strong> and handshake deals</li>
          <li><strong>$275K animals</strong> tracked on paper and memory</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- SECTION 3: THE SOLUTION — FIVE PRIMITIVES -->
  <div class="section">
    <div class="section-inner">
      <div class="glass">
        <div class="section-subtitle">The Solution</div>
        <h2 class="section-title">Charlotte's Five <span class="accent">Primitives</span></h2>
        <p class="section-body">Every actor is a <strong>NODE</strong>. Every connection is an <strong>EDGE</strong>. Every measurement is a <strong>METRIC</strong>. Every event is a <strong>SIGNAL</strong>. Every expectation is a <strong>PROTOCOL</strong>.</p>
        <div class="prim-grid">
          <div class="prim-card">
            <span class="prim-icon">&#x25C9;</span>
            <div class="prim-name c-purple">NODE</div>
            <div class="prim-examples"><strong>Animal</strong> (ear notch)<br><strong>Breeder</strong> (herdmark)<br><strong>Buyer</strong> &middot; <strong>Sire</strong> &middot; <strong>Dam</strong></div>
          </div>
          <div class="prim-card">
            <span class="prim-icon">&#x2194;</span>
            <div class="prim-name c-magenta">EDGE</div>
            <div class="prim-examples"><strong>isSireOf</strong> &middot; <strong>isDamOf</strong><br><strong>bredBy</strong> &middot; <strong>soldTo</strong><br><strong>registeredWith</strong></div>
          </div>
          <div class="prim-card">
            <span class="prim-icon">&#x25B2;</span>
            <div class="prim-name c-cyan">METRIC</div>
            <div class="prim-examples"><strong>Weight</strong> &middot; <strong>Daily Gain</strong><br><strong>Litter Size</strong><br><strong>Sale Price</strong> &middot; <strong>Bid Count</strong></div>
          </div>
          <div class="prim-card">
            <span class="prim-icon">&#x26A1;</span>
            <div class="prim-name c-red">SIGNAL</div>
            <div class="prim-examples"><strong>Farrowing</strong> &middot; <strong>Breeding</strong><br><strong>Sale</strong> &middot; <strong>Show Placement</strong><br><strong>Weigh-in</strong></div>
          </div>
          <div class="prim-card">
            <span class="prim-icon">&#x2696;</span>
            <div class="prim-name c-gold">PROTOCOL</div>
            <div class="prim-examples"><strong>Gestation</strong> (114d)<br><strong>Registration</strong><br><strong>Show Check-in</strong> &middot; <strong>Health Screen</strong></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- SECTION 4: FARM BY FARM -->
  <div class="section">
    <div class="section-inner">
      <div class="glass">
        <div class="section-subtitle">The Strategy</div>
        <h2 class="section-title">Farm by farm &mdash; the <span class="accent">traveling salesman</span></h2>
        <p class="section-body">The swine industry is a network of barns. The question is: where do you go first, and where do you go next, to scan the entire industry? This is a service-based model &mdash; human-centric onboarding, then robotic operation. <strong>We come to your farm. We sit with you. We build the digital twin together.</strong> Everything after that is infrastructure.</p>

        <!-- SVG Farm Network Map -->
        <div class="farm-map-container">
          <svg viewBox="0 0 700 420" xmlns="http://www.w3.org/2000/svg">
            <!-- Grid dots -->
            <defs>
              <radialGradient id="glow-purple" cx="50%" cy="50%" r="50%">
                <stop offset="0%" stop-color="#7200CB" stop-opacity="0.3"/>
                <stop offset="100%" stop-color="#7200CB" stop-opacity="0"/>
              </radialGradient>
              <radialGradient id="glow-cyan" cx="50%" cy="50%" r="50%">
                <stop offset="0%" stop-color="#21D6C6" stop-opacity="0.4"/>
                <stop offset="100%" stop-color="#21D6C6" stop-opacity="0"/>
              </radialGradient>
            </defs>

            <!-- Connection lines (solid = active, dashed = future) -->
            <path d="M350,210 Q280,140 160,130" stroke="#7200CB" stroke-width="1.5" fill="none" opacity="0.5"/>
            <path d="M350,210 Q420,140 540,120" stroke="#7200CB" stroke-width="1.5" fill="none" opacity="0.5"/>
            <path d="M350,210 Q280,280 150,310" stroke="#7200CB" stroke-width="1.5" fill="none" opacity="0.5"/>
            <path d="M350,210 Q450,280 560,300" stroke="#7200CB" stroke-width="1.5" fill="none" opacity="0.5"/>

            <!-- Dashed future connections -->
            <path d="M350,210 Q200,180 70,230" stroke="#4A474B" stroke-width="1" fill="none" stroke-dasharray="4,6" opacity="0.4"/>
            <path d="M350,210 Q500,180 650,170" stroke="#4A474B" stroke-width="1" fill="none" stroke-dasharray="4,6" opacity="0.4"/>
            <path d="M350,210 Q300,350 200,390" stroke="#4A474B" stroke-width="1" fill="none" stroke-dasharray="4,6" opacity="0.4"/>
            <path d="M350,210 Q450,350 580,390" stroke="#4A474B" stroke-width="1" fill="none" stroke-dasharray="4,6" opacity="0.4"/>
            <path d="M350,210 Q350,80 350,30" stroke="#4A474B" stroke-width="1" fill="none" stroke-dasharray="4,6" opacity="0.4"/>

            <!-- Future unnamed nodes -->
            <circle cx="70" cy="230" r="4" fill="#4A474B" opacity="0.4"/>
            <circle cx="650" cy="170" r="4" fill="#4A474B" opacity="0.4"/>
            <circle cx="200" cy="390" r="4" fill="#4A474B" opacity="0.4"/>
            <circle cx="580" cy="390" r="4" fill="#4A474B" opacity="0.4"/>
            <circle cx="350" cy="30" r="4" fill="#4A474B" opacity="0.4"/>

            <!-- Center: Paris IL -->
            <circle cx="350" cy="210" r="40" fill="url(#glow-cyan)"/>
            <circle cx="350" cy="210" r="8" fill="#21D6C6"/>
            <circle cx="350" cy="210" r="14" fill="none" stroke="#21D6C6" stroke-width="0.8" opacity="0.3">
              <animate attributeName="r" values="14;26;14" dur="3s" repeatCount="indefinite"/>
              <animate attributeName="opacity" values="0.3;0;0.3" dur="3s" repeatCount="indefinite"/>
            </circle>
            <text x="350" y="240" text-anchor="middle" class="farm-center-label">PARIS, IL</text>
            <text x="350" y="254" text-anchor="middle" class="farm-sublabel">Origin</text>

            <!-- Farm 1: Trogdon Show Pigs -->
            <circle cx="160" cy="130" r="24" fill="url(#glow-purple)"/>
            <circle cx="160" cy="130" r="6" fill="#7200CB"/>
            <text x="160" y="108" text-anchor="middle" class="farm-label">Trogdon Show Pigs</text>
            <text x="160" y="120" text-anchor="middle" class="farm-sublabel">Cofounder &middot; 20K cycles &middot; 1,176 sales</text>

            <!-- Farm 2: Farnham Farms -->
            <circle cx="540" cy="120" r="20" fill="url(#glow-purple)"/>
            <circle cx="540" cy="120" r="5" fill="#7200CB"/>
            <text x="540" y="100" text-anchor="middle" class="farm-label">Farnham Farms</text>
            <text x="540" y="112" text-anchor="middle" class="farm-sublabel">6,301 animals &middot; Poland specialist</text>

            <!-- Farm 3: Hi Point Genetics -->
            <circle cx="150" cy="310" r="18" fill="url(#glow-purple)"/>
            <circle cx="150" cy="310" r="5" fill="#7200CB"/>
            <text x="150" y="334" text-anchor="middle" class="farm-label">Hi Point Genetics</text>
            <text x="150" y="346" text-anchor="middle" class="farm-sublabel">Spot breed specialist</text>

            <!-- Farm 4: Premium Blend Genetics -->
            <circle cx="560" cy="300" r="18" fill="url(#glow-purple)"/>
            <circle cx="560" cy="300" r="5" fill="#7200CB"/>
            <text x="560" y="324" text-anchor="middle" class="farm-label">Premium Blend Genetics</text>
            <text x="560" y="336" text-anchor="middle" class="farm-sublabel">Duroc specialist</text>
          </svg>
        </div>

        <p class="section-body" style="margin-top:16px">The human relationship is the entry point. The robotic infrastructure is what stays. Every shared sire, buyer, and show result stitches the new barn into the collective graph.</p>

        <!-- Contract type cards -->
        <div class="contract-grid">
          <div class="contract-card">
            <h4>Genetics Company</h4>
            <p>Full breeding management, pedigree registration, sale facilitation</p>
          </div>
          <div class="contract-card">
            <h4>Show Operation</h4>
            <p>Show management, analytics, scouting, &ldquo;the Draft&rdquo;</p>
          </div>
          <div class="contract-card">
            <h4>Registry Partner</h4>
            <p>Infrastructure &mdash; handle registration processing at scale</p>
          </div>
          <div class="contract-card">
            <h4>Commercial Farm</h4>
            <p>Health screening, performance testing, biosecurity</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- SECTION 5: CROSSBRED PEDIGREE -->
  <div class="section">
    <div class="section-inner">
      <div class="glass">
        <div class="section-subtitle">The Centerpiece</div>
        <h2 class="section-title">Crossbred <span class="accent">Pedigree</span></h2>
        <p class="section-body">Ancestry trees for animals that have never been registered.</p>
        <ul class="problem-list">
          <li><strong>Purebred pedigrees</strong> exist in registry databases (NSR, CPS, ABA)</li>
          <li><strong>Crossbred pedigrees exist nowhere</strong> &mdash; only in sale receipts and breeder memory</li>
          <li>Charlotte reconstructs lineage from: <strong>sire names on sale catalogs</strong>, dam names in breeding records, maternal grandsire from Exposition data, ownership chains</li>
          <li>Every <strong>hasSire</strong>, <strong>hasDam</strong>, <strong>isGrandsireOf</strong> edge in the graph IS the crossbred pedigree</li>
          <li><strong>401,788 KRF facts</strong> already building the tree</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- SECTION 6: NSR COLLABORATION -->
  <div class="section">
    <div class="section-inner">
      <div class="glass">
        <div class="section-subtitle">Partnership</div>
        <h2 class="section-title">Working with the <span class="accent">National Swine Registry</span></h2>
        <p class="section-body">Collaborating to modernize the industry across five priority areas.</p>
        <div class="priority-grid">
          <div class="priority-card">
            <div class="priority-num">1</div>
            <div>
              <h4>Show Management</h4>
              <p>Check-in, class breaks, results, premium calculations</p>
            </div>
          </div>
          <div class="priority-card">
            <div class="priority-num">2</div>
            <div>
              <h4>Crossbred Ancestral Tree</h4>
              <p>AI-built family trees for the crossbred database</p>
            </div>
          </div>
          <div class="priority-card">
            <div class="priority-num">3</div>
            <div>
              <h4>Show &amp; Industry Analytics</h4>
              <p>Scouting metrics, &ldquo;the Draft&rdquo; &mdash; performance data for every animal</p>
            </div>
          </div>
          <div class="priority-card">
            <div class="priority-num">4</div>
            <div>
              <h4>Biosecurity</h4>
              <p>TSA Pre-style health paper evaluation at shows and sales</p>
            </div>
          </div>
          <div class="priority-card">
            <div class="priority-num">5</div>
            <div>
              <h4>Digital Competition Platform</h4>
              <p>Online skillathon for junior members &mdash; education meets engagement</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- SECTION 7: THE DATA -->
  <div class="section">
    <div class="section-inner">
      <div class="glass">
        <div class="section-subtitle">What Exists Today</div>
        <h2 class="section-title">The <span class="accent">Data</span></h2>
        <div class="data-grid">
          <div class="data-card">
            <span class="d-val">77,982</span>
            <span class="d-lbl">Registered Breeders</span>
          </div>
          <div class="data-card">
            <span class="d-val">582</span>
            <span class="d-lbl">Named Sires</span>
          </div>
          <div class="data-card">
            <span class="d-val">20,329</span>
            <span class="d-lbl">Breeding Cycles</span>
          </div>
          <div class="data-card">
            <span class="d-val">3,974</span>
            <span class="d-lbl">NSR Show Results</span>
          </div>
          <div class="data-card">
            <span class="d-val">3,328</span>
            <span class="d-lbl">Auction Lots</span>
          </div>
          <div class="data-card">
            <span class="d-val">104K</span>
            <span class="d-lbl">Temporal Spine Edges</span>
          </div>
          <div class="data-card">
            <span class="d-val">401,788</span>
            <span class="d-lbl">Total KRF Facts</span>
          </div>
          <div class="data-card">
            <span class="d-val">S-expr</span>
            <span class="d-lbl">Charlotte Format</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- SECTION 8: WHERE WE ARE GOING -->
  <div class="section">
    <div class="section-inner">
      <div class="glass">
        <div class="section-subtitle">Vision</div>
        <h2 class="section-title">Where we are <span class="accent">going</span></h2>
        <p class="section-body">Unified pedigree platform for <strong>CPS + NSR + ABA + crossbreeds</strong>. Handle registration for Certified Pedigree Swine, Tamworth Swine Association, and National Swine Registry &mdash; then extend into crossbred ancestry that no existing system tracks.</p>
        <p class="closing-line">One graph. <strong>Every breeder.</strong> Every animal. <strong>Every sale.</strong> Every show.<br>From <strong>Paris, Illinois</strong> outward.</p>
      </div>
    </div>
  </div>

  <!-- Final spacer -->
  <div class="spacer"></div>

</div>

<!-- ═══ SCROLL ANIMATION ═══ -->
<script>
(function(){
  var panels = document.querySelectorAll('.glass');
  var observer = new IntersectionObserver(function(entries){
    entries.forEach(function(entry){
      if(entry.isIntersecting) entry.target.classList.add('visible');
    });
  }, {threshold:0.12, rootMargin:'0px 0px -40px 0px'});
  panels.forEach(function(p){ observer.observe(p); });
})();
</script>

<!-- ═══ 3D FORCE GRAPH (BACKGROUND) ═══ -->
<script type="importmap">
{ "imports": { "three": "https://cdn.jsdelivr.net/npm/three@0.162.0/build/three.module.js", "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.162.0/examples/jsm/" } }
</script>
<script type="module">
import * as THREE from 'three';
import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

// === TYPE CONFIGURATION ===
const TYPE_CFG = {
    primitive:    { color: 0xbc8cff, css: '#bc8cff', label: 'Charlotte Primitive', geo: 'ico',   emissive: true },
    breed:        { color: 0xd4a373, css: '#d4a373', label: 'Breed',              geo: 'sphere', emissive: false },
    registry:     { color: 0x4ecdc4, css: '#4ecdc4', label: 'Registry',           geo: 'oct',    emissive: false },
    state:        { color: 0xffe066, css: '#ffe066', label: 'State',              geo: 'box',    emissive: false },
    relationship: { color: 0xff6b6b, css: '#ff6b6b', label: 'Edge Type',          geo: 'tetra',  emissive: false },
    pipeline:     { color: 0x95e1d3, css: '#95e1d3', label: 'Pipeline Stage',     geo: 'cyl',    emissive: false },
    fact_type:    { color: 0xf38181, css: '#f38181', label: 'FACT Type',          geo: 'dodec',  emissive: false },
    product:      { color: 0xaa96da, css: '#aa96da', label: 'Genetics Partner',   geo: 'sphere', emissive: false },
    animal_type:  { color: 0xa8e6cf, css: '#a8e6cf', label: 'Animal Type',        geo: 'sphere', emissive: false },
    health:       { color: 0xff8b94, css: '#ff8b94', label: 'Health Category',    geo: 'box',    emissive: false },
    buyer:        { color: 0xffd3b6, css: '#ffd3b6', label: 'Top Buyer',          geo: 'sphere', emissive: false },
    year:         { color: 0xdcedc1, css: '#dcedc1', label: 'Auction Year',       geo: 'sphere', emissive: false },
    sire:         { color: 0xc9a96e, css: '#c9a96e', label: 'Key Sire',           geo: 'sphere', emissive: false },
    show:         { color: 0xe9c46a, css: '#e9c46a', label: 'Show / Event',       geo: 'box',    emissive: false },
    source:       { color: 0x78c4d4, css: '#78c4d4', label: 'Data Source',        geo: 'oct',    emissive: false }
};

// === NODE DATA ===
const nodes = [
    // Charlotte Primitives
    { id:'NODE',     type:'primitive', label:'NODE',     size:3.5, desc:'Identity' },
    { id:'EDGE',     type:'primitive', label:'EDGE',     size:3.5, desc:'Relationship' },
    { id:'METRIC',   type:'primitive', label:'METRIC',   size:3.5, desc:'Measurement' },
    { id:'SIGNAL',   type:'primitive', label:'SIGNAL',   size:3.5, desc:'Event' },
    { id:'PROTOCOL', type:'primitive', label:'PROTOCOL', size:3.5, desc:'Rule' },
    // Breeds
    { id:'BERKSHIRE',  type:'breed', label:'Berkshire',     size:2.4, color:0x8B4513 },
    { id:'CHESTER',    type:'breed', label:'Chester White', size:2.9, color:0xD2691E },
    { id:'DUROC',      type:'breed', label:'Duroc',         size:2.0, color:0xCD5C5C },
    { id:'HAMPSHIRE',  type:'breed', label:'Hampshire',     size:2.0, color:0x2E8B57 },
    { id:'HEREFORD',   type:'breed', label:'Hereford',      size:2.7, color:0xB22222 },
    { id:'LANDRACE',   type:'breed', label:'Landrace',      size:1.8, color:0xDEB887 },
    { id:'POLAND',     type:'breed', label:'Poland China',  size:2.8, color:0x666666 },
    { id:'SPOT',       type:'breed', label:'Spot',          size:2.9, color:0x808080 },
    { id:'YORKSHIRE',  type:'breed', label:'Yorkshire',     size:1.8, color:0xFFE4C4 },
    { id:'TAMWORTH',   type:'breed', label:'Tamworth',      size:1.5, color:0xFF8C00 },
    { id:'CROSS',      type:'breed', label:'Crossbred',     size:1.5, color:0x9ACD32 },
    // Registries
    { id:'CPS', type:'registry', label:'CPS',  size:2.8 },
    { id:'NSR', type:'registry', label:'NSR',  size:2.2 },
    { id:'ABA', type:'registry', label:'ABA',  size:2.4 },
    // Top States
    { id:'IN', type:'state', label:'IN', size:2.2 },
    { id:'OK', type:'state', label:'OK', size:2.0 },
    { id:'TX', type:'state', label:'TX', size:2.0 },
    { id:'IL', type:'state', label:'IL', size:1.8 },
    { id:'OH', type:'state', label:'OH', size:1.7 },
    { id:'MO', type:'state', label:'MO', size:1.5 },
    { id:'IA', type:'state', label:'IA', size:1.5 },
    { id:'WI', type:'state', label:'WI', size:1.4 },
    { id:'KS', type:'state', label:'KS', size:1.3 },
    { id:'PA', type:'state', label:'PA', size:1.2 },
    { id:'MN', type:'state', label:'MN', size:1.2 },
    { id:'TN', type:'state', label:'TN', size:1.2 },
    // Edge Types
    { id:'IS_SIRE_OF', type:'relationship', label:'IS_SIRE_OF', size:1.2 },
    { id:'IS_DAM_OF',  type:'relationship', label:'IS_DAM_OF',  size:1.2 },
    { id:'BRED_BY',    type:'relationship', label:'BRED_BY',    size:1.2 },
    { id:'OWNED_BY',   type:'relationship', label:'OWNED_BY',   size:1.2 },
    { id:'SOLD_TO',    type:'relationship', label:'SOLD_TO',    size:1.2 },
    { id:'BORN_ON',    type:'relationship', label:'BORN_ON',    size:1.2 },
    { id:'FARROWED_ON',type:'relationship', label:'FARROWED_ON',size:1.2 },
    { id:'HAS_A',      type:'relationship', label:'HAS_A',      size:1.0 },
    { id:'IS_A',       type:'relationship', label:'IS_A',       size:1.0 },
    { id:'CUSTOMER_OF',type:'relationship', label:'CUSTOMER_OF',size:1.0 },
    // Pipeline
    { id:'SCRAPE',    type:'pipeline', label:'SCRAPE',    size:1.6 },
    { id:'PARSE',     type:'pipeline', label:'PARSE',     size:1.6 },
    { id:'NORMALIZE', type:'pipeline', label:'NORMALIZE', size:1.6 },
    { id:'GENERATE',  type:'pipeline', label:'GENERATE',  size:1.6 },
    { id:'AGGREGATE', type:'pipeline', label:'AGGREGATE', size:1.6 },
    { id:'DEPLOY',    type:'pipeline', label:'DEPLOY',    size:1.6 },
    // FACT Types
    { id:'NEURON',             type:'fact_type', label:'NEURON',             size:1.5 },
    { id:'NEURAL_DATAFRAME',   type:'fact_type', label:'NEURAL_DATAFRAME',   size:1.5 },
    { id:'COMPOUND_DATAFRAME', type:'fact_type', label:'COMPOUND_DATAFRAME', size:1.5 },
    { id:'SALE_FACT',          type:'fact_type', label:'SALE',               size:1.5 },
    // Products / Partners
    { id:'BAADE',         type:'product', label:'Baade Genetics',      size:1.0 },
    { id:'GENETIC_EDGE',  type:'product', label:'Genetic Edge',        size:1.0 },
    { id:'HEIMER_HAMPS',  type:'product', label:'Heimer Hampshires',   size:1.0 },
    { id:'HI_POINT',      type:'product', label:'Hi Point Genetics',   size:1.0 },
    { id:'PERRY',         type:'product', label:'Perry Swine',         size:1.0 },
    { id:'PREMIUM_BLEND', type:'product', label:'Premium Blend',       size:1.0 },
    { id:'SOUTHERN_GOLD', type:'product', label:'Southern Gold',       size:1.0 },
    { id:'TOP_CUT',       type:'product', label:'Top Cut Genetics',    size:1.0 },
    // Animal Types
    { id:'GILT',   type:'animal_type', label:'GILT',   size:1.4 },
    { id:'BARROW', type:'animal_type', label:'BARROW', size:1.4 },
    { id:'BOAR',   type:'animal_type', label:'BOAR',   size:1.2 },
    // Health Categories
    { id:'DISEASES',    type:'health', label:'DISEASES',    size:1.4 },
    { id:'MEDICATIONS', type:'health', label:'MEDICATIONS', size:1.4 },
    { id:'SUPPLEMENTS', type:'health', label:'SUPPLEMENTS', size:1.4 },
    // Top Buyers
    { id:'DAN_SCROGGINS',     type:'buyer', label:'Dan Scroggins',     size:1.3 },
    { id:'DOUG_SMITH',        type:'buyer', label:'Doug Smith',        size:1.1 },
    { id:'JOSH_CAMPBELL',     type:'buyer', label:'Josh Campbell',     size:1.0 },
    { id:'CRAIG_HAMIL',       type:'buyer', label:'Craig Hamil',       size:1.0 },
    { id:'DAVE_GUYER',        type:'buyer', label:'Dave Guyer',        size:0.9 },
    { id:'NATALIE_HOFCHULTE', type:'buyer', label:'Natalie Hofchulte', size:0.9 },
    { id:'JOSH_DOUGLASS',     type:'buyer', label:'Josh Douglass',     size:0.9 },
    { id:'JOSH_POWELL',       type:'buyer', label:'Josh Powell',       size:0.9 },
    // Auction Years
    { id:'Y2017', type:'year', label:'2017', size:1.2 },
    { id:'Y2018', type:'year', label:'2018', size:1.5 },
    { id:'Y2019', type:'year', label:'2019', size:1.6 },
    { id:'Y2020', type:'year', label:'2020', size:1.5 },
    { id:'Y2021', type:'year', label:'2021', size:1.4 },
    { id:'Y2022', type:'year', label:'2022', size:1.2 },
    // Key Sires
    { id:'MONEY_LINE',     type:'sire', label:'Money Line',     size:1.1 },
    { id:'SLOW_MOTION',    type:'sire', label:'Slow Motion',    size:1.1 },
    { id:'CLAWS',          type:'sire', label:'Claws',          size:1.1 },
    { id:'WILD_RIDE',      type:'sire', label:'Wild Ride',      size:1.1 },
    { id:'QUITE_FRANKLY',  type:'sire', label:'Quite Frankly',  size:1.1 },
    { id:'BATTLE_CRY',     type:'sire', label:'Battle Cry',     size:1.1 },
    // Shows
    { id:'THE_EXPOSITION',      type:'show', label:'The Exposition',      size:1.4 },
    { id:'SUMMER_SPECTACULAR',  type:'show', label:'Summer Spectacular',  size:1.4 },
    { id:'NATIONAL_SWINE_EXPO', type:'show', label:'National Swine Expo', size:1.4 },
    // Data Sources
    { id:'NSR_WEBSITE',  type:'source', label:'NSR Website',  size:1.3 },
    { id:'CPS_WEBSITE',  type:'source', label:'CPS Website',  size:1.3 },
    { id:'WENDT_GROUP',  type:'source', label:'Wendt Group',  size:1.3 }
];

// === EDGE DATA ===
const edges = [
    // Primitives -> Domain
    {s:'NODE',e:'BERKSHIRE',w:2},{s:'NODE',e:'CHESTER',w:2},{s:'NODE',e:'DUROC',w:2},{s:'NODE',e:'HAMPSHIRE',w:2},{s:'NODE',e:'HEREFORD',w:2},
    {s:'NODE',e:'GILT',w:1.5},{s:'NODE',e:'BARROW',w:1.5},{s:'NODE',e:'BOAR',w:1.5},
    {s:'EDGE',e:'IS_SIRE_OF',w:2},{s:'EDGE',e:'IS_DAM_OF',w:2},{s:'EDGE',e:'BRED_BY',w:2},{s:'EDGE',e:'OWNED_BY',w:2},{s:'EDGE',e:'SOLD_TO',w:2},{s:'EDGE',e:'BORN_ON',w:1.5},{s:'EDGE',e:'FARROWED_ON',w:1.5},{s:'EDGE',e:'HAS_A',w:1.5},{s:'EDGE',e:'IS_A',w:1.5},{s:'EDGE',e:'CUSTOMER_OF',w:1.5},
    {s:'METRIC',e:'SALE_FACT',w:1.5},{s:'METRIC',e:'NEURON',w:1.5},
    {s:'SIGNAL',e:'SALE_FACT',w:1.5},{s:'SIGNAL',e:'NEURON',w:1.5},{s:'SIGNAL',e:'NEURAL_DATAFRAME',w:1.5},
    {s:'PROTOCOL',e:'DISEASES',w:2},{s:'PROTOCOL',e:'MEDICATIONS',w:2},{s:'PROTOCOL',e:'SUPPLEMENTS',w:2},
    // Breeds -> Registries
    {s:'CHESTER',e:'CPS',w:1.5},{s:'SPOT',e:'CPS',w:1.5},{s:'POLAND',e:'CPS',w:1.5},{s:'HEREFORD',e:'CPS',w:1.5},
    {s:'BERKSHIRE',e:'ABA',w:1.5},{s:'BERKSHIRE',e:'NSR',w:1},
    {s:'DUROC',e:'NSR',w:1.5},{s:'HAMPSHIRE',e:'NSR',w:1.5},{s:'YORKSHIRE',e:'NSR',w:1.5},{s:'LANDRACE',e:'NSR',w:1.5},{s:'TAMWORTH',e:'NSR',w:1},
    // Registries -> States
    {s:'CPS',e:'IN',w:1.2},{s:'CPS',e:'OK',w:1},{s:'CPS',e:'TX',w:1},{s:'CPS',e:'IL',w:1},{s:'CPS',e:'OH',w:1},
    {s:'NSR',e:'IN',w:0.8},{s:'NSR',e:'MO',w:0.8},{s:'NSR',e:'IA',w:0.8},{s:'NSR',e:'WI',w:0.8},
    {s:'ABA',e:'IN',w:0.8},{s:'ABA',e:'OH',w:0.8},{s:'ABA',e:'TX',w:0.8},{s:'ABA',e:'IL',w:0.8},
    // Pipeline chain
    {s:'SCRAPE',e:'PARSE',w:2.5},{s:'PARSE',e:'NORMALIZE',w:2.5},{s:'NORMALIZE',e:'GENERATE',w:2.5},{s:'GENERATE',e:'AGGREGATE',w:2.5},{s:'AGGREGATE',e:'DEPLOY',w:2.5},
    // Pipeline -> Sources
    {s:'SCRAPE',e:'NSR_WEBSITE',w:1.5},{s:'SCRAPE',e:'CPS_WEBSITE',w:1.5},{s:'SCRAPE',e:'WENDT_GROUP',w:1.5},
    // Pipeline -> FACT Types
    {s:'GENERATE',e:'NEURON',w:1.5},{s:'GENERATE',e:'SALE_FACT',w:1.5},
    {s:'AGGREGATE',e:'NEURAL_DATAFRAME',w:1.5},{s:'AGGREGATE',e:'COMPOUND_DATAFRAME',w:1.5},
    // FACT type chain
    {s:'NEURON',e:'NEURAL_DATAFRAME',w:1.5},{s:'NEURAL_DATAFRAME',e:'COMPOUND_DATAFRAME',w:1.5},
    // Products -> Breeds
    {s:'HEIMER_HAMPS',e:'HAMPSHIRE',w:1},{s:'BAADE',e:'DUROC',w:1},{s:'GENETIC_EDGE',e:'BERKSHIRE',w:1},
    {s:'HI_POINT',e:'SPOT',w:1},{s:'PERRY',e:'YORKSHIRE',w:1},{s:'PREMIUM_BLEND',e:'DUROC',w:1},
    {s:'SOUTHERN_GOLD',e:'CHESTER',w:1},{s:'TOP_CUT',e:'HAMPSHIRE',w:1},
    // Buyers -> Years
    {s:'DAN_SCROGGINS',e:'Y2018',w:1},{s:'DAN_SCROGGINS',e:'Y2019',w:1},{s:'DAN_SCROGGINS',e:'Y2020',w:1},
    {s:'DOUG_SMITH',e:'Y2019',w:1},{s:'DOUG_SMITH',e:'Y2020',w:1},
    {s:'JOSH_CAMPBELL',e:'Y2018',w:1},{s:'JOSH_CAMPBELL',e:'Y2019',w:1},
    {s:'CRAIG_HAMIL',e:'Y2017',w:1},{s:'CRAIG_HAMIL',e:'Y2018',w:1},
    {s:'DAVE_GUYER',e:'Y2020',w:1},{s:'NATALIE_HOFCHULTE',e:'Y2021',w:1},
    {s:'JOSH_DOUGLASS',e:'Y2019',w:1},{s:'JOSH_POWELL',e:'Y2020',w:1},
    // Years -> Wendt Group
    {s:'Y2017',e:'WENDT_GROUP',w:0.8},{s:'Y2018',e:'WENDT_GROUP',w:0.8},{s:'Y2019',e:'WENDT_GROUP',w:0.8},
    {s:'Y2020',e:'WENDT_GROUP',w:0.8},{s:'Y2021',e:'WENDT_GROUP',w:0.8},{s:'Y2022',e:'WENDT_GROUP',w:0.8},
    // Sires -> Breeds
    {s:'MONEY_LINE',e:'DUROC',w:1},{s:'SLOW_MOTION',e:'HAMPSHIRE',w:1},{s:'CLAWS',e:'BERKSHIRE',w:1},
    {s:'WILD_RIDE',e:'DUROC',w:1},{s:'QUITE_FRANKLY',e:'YORKSHIRE',w:1},{s:'BATTLE_CRY',e:'HAMPSHIRE',w:1},
    // Sires -> IS_SIRE_OF
    {s:'MONEY_LINE',e:'IS_SIRE_OF',w:0.6},{s:'BATTLE_CRY',e:'IS_SIRE_OF',w:0.6},
    // Shows -> States + Breeds
    {s:'THE_EXPOSITION',e:'IL',w:0.8},{s:'SUMMER_SPECTACULAR',e:'IN',w:0.8},{s:'NATIONAL_SWINE_EXPO',e:'OH',w:0.8},
    {s:'THE_EXPOSITION',e:'BERKSHIRE',w:0.6},{s:'SUMMER_SPECTACULAR',e:'CHESTER',w:0.6},{s:'NATIONAL_SWINE_EXPO',e:'DUROC',w:0.6},
    // Animal types -> Breeds
    {s:'GILT',e:'BERKSHIRE',w:0.5},{s:'BARROW',e:'DUROC',w:0.5},{s:'BOAR',e:'HAMPSHIRE',w:0.5}
];

// === INITIALIZE NODE POSITIONS ===
const typeRadius = { primitive:0, breed:28, registry:38, state:55, relationship:22, pipeline:45, fact_type:35, product:42, animal_type:18, health:15, buyer:60, year:52, sire:35, show:50, source:55 };
const nodeMap = {};
nodes.forEach((n, i) => {
    const r = (typeRadius[n.type] || 40) + (Math.random() - 0.5) * 12;
    const theta = (i / nodes.length) * Math.PI * 2 + (Math.random() - 0.5) * 0.5;
    const phi = Math.PI * 0.3 + Math.random() * Math.PI * 0.4;
    n.x = r * Math.sin(phi) * Math.cos(theta);
    n.y = r * Math.cos(phi) + (Math.random() - 0.5) * 10;
    n.z = r * Math.sin(phi) * Math.sin(theta);
    n.vx = 0; n.vy = 0; n.vz = 0;
    nodeMap[n.id] = n;
});

// === THREE.JS SETUP ===
const W = window.innerWidth, H = window.innerHeight;
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(55, W / H, 0.1, 1200);
camera.position.set(0, 40, 130);
const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: false, powerPreference: 'high-performance' });
renderer.setSize(W, H);
renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
renderer.setClearColor(0x0a0a0f);
document.getElementById('canvas-container').appendChild(renderer.domElement);

const controls = new OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;
controls.dampingFactor = 0.08;
controls.minDistance = 30;
controls.maxDistance = 300;
controls.autoRotate = true;
controls.autoRotateSpeed = 0.3;
controls.enableZoom = false;
controls.enablePan = false;
controls.enableRotate = false;

// Lights
scene.add(new THREE.AmbientLight(0x444455, 0.6));
const light1 = new THREE.PointLight(0xbc8cff, 1.5, 200);
light1.position.set(0, 20, 0);
scene.add(light1);
const light2 = new THREE.PointLight(0xd4a373, 1, 180);
light2.position.set(50, -10, 30);
scene.add(light2);
const light3 = new THREE.PointLight(0x4ecdc4, 0.8, 160);
light3.position.set(-40, 10, -30);
scene.add(light3);

// === STARFIELD ===
const starCount = 3000;
const starPos = new Float32Array(starCount * 3);
const starColors = new Float32Array(starCount * 3);
for (let i = 0; i < starCount; i++) {
    const r = 200 + Math.random() * 400;
    const theta = Math.random() * Math.PI * 2;
    const phi = Math.acos(2 * Math.random() - 1);
    starPos[i*3] = r * Math.sin(phi) * Math.cos(theta);
    starPos[i*3+1] = r * Math.sin(phi) * Math.sin(theta);
    starPos[i*3+2] = r * Math.cos(phi);
    const brightness = 0.3 + Math.random() * 0.7;
    starColors[i*3] = brightness;
    starColors[i*3+1] = brightness;
    starColors[i*3+2] = brightness * (0.8 + Math.random() * 0.2);
}
const starsGeo = new THREE.BufferGeometry();
starsGeo.setAttribute('position', new THREE.BufferAttribute(starPos, 3));
starsGeo.setAttribute('color', new THREE.BufferAttribute(starColors, 3));
scene.add(new THREE.Points(starsGeo, new THREE.PointsMaterial({ size: 0.5, vertexColors: true, transparent: true, opacity: 0.7 })));

// === GEOMETRY CACHE ===
const geoCache = {
    ico:   new THREE.IcosahedronGeometry(1, 2),
    sphere: new THREE.SphereGeometry(1, 16, 16),
    oct:   new THREE.OctahedronGeometry(1),
    box:   new THREE.BoxGeometry(1.5, 1.5, 1.5),
    tetra: new THREE.TetrahedronGeometry(1),
    cyl:   new THREE.CylinderGeometry(0.7, 0.7, 2, 16),
    dodec: new THREE.DodecahedronGeometry(1)
};

// === CREATE NODE MESHES ===
const meshes = [];
const meshMap = {};
const meshGroup = new THREE.Group();

for (const n of nodes) {
    const cfg = TYPE_CFG[n.type];
    const baseGeo = geoCache[cfg.geo];
    const color = n.color || cfg.color;
    const mat = new THREE.MeshStandardMaterial({
        color, roughness: 0.35, metalness: 0.25,
        emissive: cfg.emissive ? color : 0x000000,
        emissiveIntensity: cfg.emissive ? 0.6 : 0
    });
    const mesh = new THREE.Mesh(baseGeo, mat);
    mesh.scale.setScalar(n.size);
    mesh.position.set(n.x, n.y, n.z);
    mesh.userData = n;
    meshGroup.add(mesh);
    meshes.push(mesh);
    meshMap[n.id] = mesh;

    // Glow halo for primitives
    if (cfg.emissive) {
        const haloMat = new THREE.MeshBasicMaterial({ color, transparent: true, opacity: 0.07, side: THREE.BackSide });
        const halo = new THREE.Mesh(baseGeo, haloMat);
        halo.scale.setScalar(n.size * 2.5);
        halo.position.copy(mesh.position);
        meshGroup.add(halo);
        n._halo = halo;
    }
}
scene.add(meshGroup);

// === CREATE EDGE LINES ===
const edgeLines = [];
for (const ed of edges) {
    const srcN = nodeMap[ed.s];
    const tgtN = nodeMap[ed.e];
    if (!srcN || !tgtN) continue;
    const positions = new Float32Array(6);
    const geo = new THREE.BufferGeometry();
    geo.setAttribute('position', new THREE.BufferAttribute(positions, 3));
    const srcCfg = TYPE_CFG[srcN.type];
    const lineColor = srcCfg.color;
    const mat = new THREE.LineBasicMaterial({ color: lineColor, transparent: true, opacity: Math.min(0.35, 0.15 + (ed.w || 1) * 0.08) });
    const line = new THREE.Line(geo, mat);
    scene.add(line);
    edgeLines.push({ line, s: ed.s, e: ed.e });
}

function updateEdgePositions() {
    for (const el of edgeLines) {
        const sm = meshMap[el.s];
        const em = meshMap[el.e];
        if (!sm || !em) continue;
        const p = el.line.geometry.attributes.position.array;
        p[0] = sm.position.x; p[1] = sm.position.y; p[2] = sm.position.z;
        p[3] = em.position.x; p[4] = em.position.y; p[5] = em.position.z;
        el.line.geometry.attributes.position.needsUpdate = true;
    }
}

// === FORCE SIMULATION ===
let simAlpha = 1.0;
let simRunning = true;

function simulateStep() {
    if (!simRunning || simAlpha < 0.001) { simRunning = false; return; }
    simAlpha *= 0.992;

    // Repulsion
    for (let i = 0; i < nodes.length; i++) {
        for (let j = i + 1; j < nodes.length; j++) {
            const a = nodes[i], b = nodes[j];
            const dx = a.x - b.x, dy = a.y - b.y, dz = a.z - b.z;
            const dist2 = dx*dx + dy*dy + dz*dz + 1;
            const dist = Math.sqrt(dist2);
            const force = simAlpha * 600 / dist2;
            const fx = (dx/dist)*force, fy = (dy/dist)*force, fz = (dz/dist)*force;
            a.vx += fx; a.vy += fy; a.vz += fz;
            b.vx -= fx; b.vy -= fy; b.vz -= fz;
        }
    }

    // Attraction
    for (const ed of edges) {
        const a = nodeMap[ed.s], b = nodeMap[ed.e];
        if (!a || !b) continue;
        const dx = b.x - a.x, dy = b.y - a.y, dz = b.z - a.z;
        const dist = Math.sqrt(dx*dx + dy*dy + dz*dz) + 0.1;
        const force = simAlpha * 0.015 * (dist - 18) * (ed.w || 1);
        a.vx += (dx/dist)*force; a.vy += (dy/dist)*force; a.vz += (dz/dist)*force;
        b.vx -= (dx/dist)*force; b.vy -= (dy/dist)*force; b.vz -= (dz/dist)*force;
    }

    // Center gravity + damping
    for (const n of nodes) {
        n.vx -= n.x * 0.008 * simAlpha;
        n.vy -= n.y * 0.008 * simAlpha;
        n.vz -= n.z * 0.008 * simAlpha;
        const damp = 0.88;
        n.vx *= damp; n.vy *= damp; n.vz *= damp;
        const maxV = 4;
        n.vx = Math.max(-maxV, Math.min(maxV, n.vx));
        n.vy = Math.max(-maxV, Math.min(maxV, n.vy));
        n.vz = Math.max(-maxV, Math.min(maxV, n.vz));
        n.x += n.vx; n.y += n.vy; n.z += n.vz;

        const m = meshMap[n.id];
        m.position.set(n.x, n.y, n.z);
        if (n._halo) n._halo.position.set(n.x, n.y, n.z);
    }

    updateEdgePositions();
}

// === LABELS ===
const labelsContainer = document.getElementById('labels-container');
const labelEls = {};
for (const n of nodes) {
    const el = document.createElement('div');
    el.className = 'node-label';
    const cfg = TYPE_CFG[n.type];
    el.style.color = n.color ? '#' + n.color.toString(16).padStart(6, '0') : cfg.css;
    el.textContent = n.label;
    labelsContainer.appendChild(el);
    labelEls[n.id] = el;
}

function updateLabels() {
    const w = window.innerWidth, h = window.innerHeight;
    for (const n of nodes) {
        const m = meshMap[n.id];
        const v = m.position.clone().project(camera);
        const el = labelEls[n.id];
        if (v.z > 1 || v.z < -1) { el.style.opacity = '0'; continue; }
        const sx = (v.x * 0.5 + 0.5) * w;
        const sy = (-v.y * 0.5 + 0.5) * h;
        el.style.left = sx + 'px';
        el.style.top = (sy - n.size * 8 - 10) + 'px';

        const camDist = camera.position.distanceTo(m.position);
        const important = n.type === 'primitive' || n.type === 'breed' || n.type === 'registry';
        const show = important || camDist < 80;
        el.style.opacity = show ? '1' : '0';
        el.style.fontSize = n.type === 'primitive' ? '10px' : '8px';
        el.style.fontWeight = n.type === 'primitive' ? '700' : '400';
    }
}

// === ANIMATION LOOP ===
let frameCount = 0;
function animate() {
    requestAnimationFrame(animate);
    frameCount++;

    simulateStep();

    // Rotate primitives slowly
    for (const m of meshes) {
        if (m.userData.type === 'primitive') {
            m.rotation.x += 0.004;
            m.rotation.y += 0.003;
        }
    }

    // Pulse primitive halos
    const pulse = 0.06 + Math.sin(frameCount * 0.02) * 0.03;
    for (const n of nodes) {
        if (n._halo) n._halo.material.opacity = pulse;
    }

    controls.update();
    updateLabels();
    renderer.render(scene, camera);
}

// === RESIZE ===
window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
});

// === START ===
updateEdgePositions();
animate();
</script>
</body>
</html>
